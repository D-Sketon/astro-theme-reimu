---
import { Icon } from "astro-icon/components";

import { SPONSOR } from "../../utils/config";
import { __ } from "../../utils/i18n";
import { urlFor } from "../../utils/urlFor";
---

<div class="sponsor-wrapper">
  <div class="sponsor-button">
    <div class="sponsor-icon rotate">
      <Icon name="fa6-solid:yin-yang" size={24} />
    </div>
    <div class="sponsor-title">{__("sponsor.title")}</div>
    <div class="sponsor-icon rotate">
      <Icon name="fa6-solid:yin-yang" size={24} />
    </div>
  </div>
  <div class="sponsor-tip">{__("sponsor.tip")}</div>
  {
    SPONSOR.qr && SPONSOR.qr.length > 0 && (
      <div class="sponsor-qr">
        {SPONSOR.qr.map((item) => (
          <div class="sponsor-qr-image-wrapper">
            <img src={urlFor(item.src)} alt={item.name} width="200" />
            <p class="sponsor-qr-name">{item.name}</p>
          </div>
        ))}
      </div>
    )
  }
</div>

<script>
  const loadSponsor = () => {
    document.querySelector(".sponsor-button")?.addEventListener("click", () => {
      document.querySelector(".sponsor-button")?.classList.toggle("active");
      document.querySelector(".sponsor-tip")?.classList.toggle("active");
      document.querySelector(".sponsor-qr")?.classList.toggle("active");
    });
  };
  loadSponsor();
  document.addEventListener("astro:after-swap", loadSponsor);
</script>

<style lang="stylus">
  .sponsor-wrapper {
    display: flex;
    justify-content: center;
    flex-direction: column;
    align-items: center;
    margin: 8px 0 4px;
  }

  .sponsor-title {
    font-size: 18px;
    letter-spacing: 2px;
    color: var(--color-link);
    opacity: 0.8;
    text-decoration: none;
    transition: opacity 0.2s;
    display: block;
    padding: 10px 0;
    font-weight: 700;
    user-select: none;
    word-break: break-word;
  }

  .sponsor-icon {
    width: 30px;
    margin: 0 10px;
    opacity: 0.8;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--color-link);

    &.rotate {
      animation: rotate-all 3s linear infinite;
    }
  }

  .sponsor-button {
    margin: 8px 48px;
    display: flex;
    position: relative;
    width: fit-content;
    justify-content: center;
    border: 10px var(--color-red-3-shadow) double;
    transition: border 0.5s;
    cursor: var(--cursor-pointer) !important;

    &:hover {
      border-color: var(--color-h2-after);
    }

    &:hover + .sponsor-tip {
      opacity: 0.8;
    }

    &.active {
      border-color: var(--color-h2-after);
    }
  }

  .sponsor-tip {
    transition: opacity 0.2s;
    color: var(--color-link);
    opacity: 0;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: 1px;

    &.active {
      opacity: 0.8;
    }
  }

  .sponsor-qr {
    display: flex;
    interpolate-size: allow-keywords;
    gap: 4px;
    width: 100%;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 8px;
    height: 0;
    overflow: hidden;
    transition: height 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
    opacity: 0;
    transform: translateY(-10px);

    &.active {
      height: auto;
      opacity: 1;
      transform: translateY(0);
    }
  }

  .sponsor-qr-image-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .sponsor-qr-name {
    font-size: 14px;
    opacity: 0.9;
    color: var(--color-default);
    margin-top: 8px;
  }
</style>
