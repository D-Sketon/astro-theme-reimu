class Y{constructor(){this.queue=[]}add(t){return this.queue.push(new R(t)),this}play(){let t=0;const n=this.queue.length;if(n===0){this.complete?.();return}this.queue.forEach(s=>{const o=s.complete;s.complete=()=>{o?.(),t++,t===n&&this.complete?.()}}),this.queue.forEach(s=>s.play())}}const W={targets:void 0,duration:1/0,easing:"linear",update:void 0,complete:void 0};var X=()=>{const e={linear:()=>n=>n},t={Sine:()=>n=>1-Math.cos(n*Math.PI/2),Expo:()=>n=>n?Math.pow(2,10*n-10):0,Circ:()=>n=>1-Math.sqrt(1-n*n),Back:()=>n=>n*n*(3*n-2),Bounce:()=>n=>{let s,o=4;for(;n<((s=Math.pow(2,--o))-1)/11;);return 1/Math.pow(4,3-o)-7.5625*Math.pow((s*3-2)/22-n,2)}};return["Quad","Cubic","Quart","Quint"].forEach((n,s)=>{t[n]=()=>o=>Math.pow(o,s+2)}),Object.keys(t).forEach(n=>{const s=t[n];e["easeIn"+n]=s,e["easeOut"+n]=()=>o=>1-s()(1-o),e["easeInOut"+n]=()=>o=>o<.5?s()(o*2)/2:1-s()(o*-2+2)/2,e["easeOutIn"+n]=()=>o=>o<.5?(1-s()(1-o*2))/2:(s()(o*2-1)+1)/2}),e};const F=X(),O=(e,t,n,s,o,i=!1)=>{e[o]=i?s:(s-t)*n+t};var H=e=>{const t=Date.now(),n=t+e.duration,s=e.targets?Array.isArray(e.targets)?e.targets:[e.targets]:[],o=s.map(l=>{const f={};for(const h in e.dest)f[h]=l[h];return f}),i=(l,f,h=!1)=>{s.forEach((M,b)=>{Object.keys(e.dest).forEach(y=>{const A=parseFloat(o[b][y]);let g=e.dest[y];if(typeof g=="object"){if(!Array.isArray(g)){const{value:I,duration:T,easing:Q=e.easing}=g,L=F[Q]()((f-t)/T);f<=t+T?O(M,A,L,I,y):h&&O(M,A,L,I,y,h)}}else typeof g=="function"&&(g=g(M,b)),O(M,A,l,g,y,h)})})};let a=null;const r=()=>{const l=Date.now();l>n?(i(1,l,!0),e.isPlay=!1,a=null,e.complete?.()):(l>=t&&(i(F[e.easing]()((l-t)/e.duration),l),e.update?.(s)),a=requestAnimationFrame(r))},d=()=>{a!==null&&(cancelAnimationFrame(a),a=null,e.isPlay=!1)};return r(),d};class R{constructor(t=W){t={...W,...t};const{targets:n,duration:s,easing:o,update:i,complete:a,...r}=t;this.targets=n,this.duration=s,this.easing=o,this.update=i,this.complete=a,this.dest=r||{},this.tl=null,this.isPlay=!1}timeline(){return this.tl||(this.tl=new Y),this.tl}play(){this.isPlay||(this.isPlay=!0,this.stopFn=H(this))}stop(){this.stopFn&&(this.stopFn(),this.stopFn=void 0,this.isPlay=!1)}}const m=e=>new R(e);m.random=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;const c=e=>Array.isArray(e)?m.random(e[0],e[1]):e,K=(e,t)=>!!e.closest?.(t),N=(e,t)=>{const n=t.move.indexOf("emit");if(n>=0){const{emitRadius:s=[50,180]}=t.moveOptions[n]||{},o=m.random(0,360)*Math.PI/180,i=(m.random(0,1)?1:-1)*c(s);e.target.x=e.x+i*Math.cos(o),e.target.y=e.y+i*Math.sin(o)}},U=(e,t)=>{const n=t.move.indexOf("rotate");if(n>=0){const{angle:s=[-180,180]}=t.moveOptions[n]||{};e.target.rotation=c(s)}},z=e=>(Array.isArray(e)?e:[e,e]).map(t=>t*100);class x{constructor(t,n,s,o,i){if(this.target={},this.ctx=t,this.x=n,this.y=s,this.color=o,this.color.startsWith("var(")){const[,a]=this.color.match(/var\((--[^)]+)\)/)||[];a&&(this.color=getComputedStyle(document.documentElement).getPropertyValue(a).trim()||this.color)}this.radius=i.radius,this.alpha=i.alpha,this.lineWidth=i.lineWidth,this.rotation=0}draw(){const{ctx:t,x:n,y:s}=this;t.save(),t.translate(n,s),t.rotate(this.rotation*(Math.PI/180)),t.globalAlpha=this.alpha,this.paint(),this.lineWidth?(t.lineWidth=this.lineWidth,t.strokeStyle=this.color,t.stroke()):(t.fillStyle=this.color,t.fill()),t.globalAlpha=1,t.restore()}}class V extends x{paint(){const{ctx:t}=this;t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.closePath()}}class _ extends x{constructor(t,n,s,o,i){super(t,n,s,o,i),this.sides=c(i.sides)}paint(){const{ctx:t,sides:n,radius:s}=this;t.beginPath(),t.moveTo(s*Math.cos(0),s*Math.sin(0));for(let o=1;o<=n;o++){const i=o*2*Math.PI/n;t.lineTo(s*Math.cos(i),s*Math.sin(i))}t.closePath()}}class $ extends x{constructor(t,n,s,o,i){super(t,n,s,o,i),this.spikes=c(i.spikes)}paint(){const{ctx:t,spikes:n,radius:s}=this;t.beginPath(),t.moveTo(0,-s);for(let o=0;o<n*2;o++){const i=o*Math.PI/n-Math.PI/2,a=o%2===0?s:s*.5,r=Math.cos(i)*a,d=Math.sin(i)*a;t.lineTo(r,d)}t.closePath()}}const B={circle:V,polygon:_,star:$},G=(e,t)=>{B[e]=t},J=(e,t,n,s)=>{const o=B[s.shape],{shapeOptions:i,colors:a,number:r}=s;let{radius:d=0,alpha:l=1,lineWidth:f=0}=i||{};return Array.from({length:c(r)},()=>{if(!o)throw new Error(`Entity type "${s.shape}" is not registered.`);const h=new o(e,t,n,a[m.random(0,a.length-1)],{...i,radius:c(d),alpha:c(z(l))/100,lineWidth:c(f)});return N(h,s),U(h,s),h})},k=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?"touchstart":"click",Z=()=>{const e=document.createElement("canvas");return e.style.cssText="position:fixed;top:0;left:0;pointer-events:none;z-index:9999999",document.body.appendChild(e),e},q=(e,t)=>{if(!t)return;const{clientWidth:n,clientHeight:s}=document.documentElement;e.width=n*2,e.height=s*2,e.style.width=n+"px",e.style.height=s+"px",t.setTransform(1,0,0,1,0,0),t.scale(2,2)},tt=e=>{const{clientX:t,clientY:n}=e.touches?.[0]??e;return{clientX:t,clientY:n}},S=e=>{const{alpha:t=0,alphaEasing:n="linear",alphaDuration:s=[600,800]}=e;return{value:c(z(t))/100,easing:n,duration:c(s)}},et=e=>{const{move:t,moveOptions:n}=e,s={};return t.forEach((o,i)=>{const a=n[i]||{};if(o==="emit"){const{radius:r=.1,alphaChange:d=!1}=a;s.x=l=>l.target.x,s.y=l=>l.target.y,s.radius=c(r),d&&(s.alpha=S(a))}else if(o==="diffuse"){const{diffuseRadius:r=[80,160],lineWidth:d=0}=a;s.radius=c(r),s.lineWidth=c(d),s.alpha=S(a)}else o==="rotate"&&(s.rotation=r=>r.target.rotation)}),s},st=e=>{for(const t of e)t.draw()};let u=null,v=null,P=null,w=null,E=[],p=null,C=null;const D=e=>{C?.(),u=Z();const t=u.getContext("2d");return w=m({duration:1/0,update(){t&&t.clearRect(0,0,u.width,u.height)}}),v=n=>{if(e.excludeElements.some(i=>K(n.target,i)))return;w.play();const{clientX:s,clientY:o}=tt(n);nt(s,o,t,e)},document.addEventListener(k,v,!1),q(u,t),P=new ResizeObserver(()=>q(u,t)),P.observe(document.documentElement),C=()=>{v&&document.removeEventListener(k,v,!1),P?.disconnect(),E.forEach(n=>n?.queue.forEach(s=>s.stop())),w?.stop(),u?.remove(),v=P=w=u=null,E=[]},C},nt=(e,t,n,s)=>{if(!s||!n)return;const o=m().timeline();o.complete=()=>{const i=E.indexOf(o);i>-1&&(E[i]=null)},s.particles.forEach(i=>{const{move:a,moveOptions:r}=i;i.move=Array.isArray(a)?a:[a],i.moveOptions=r?Array.isArray(r)?r:[r]:[],o.add({targets:J(n,e,t,i),duration:c(i.duration),easing:i.easing||"linear",update:st,...et(i)})}),E.push(o),o.play()},j=e=>{if(document.readyState==="loading"){let t=null;return p&&window.removeEventListener("DOMContentLoaded",p),p=()=>{t=D(e),p=null},window.addEventListener("DOMContentLoaded",p,{passive:!0}),()=>{p&&(window.removeEventListener("DOMContentLoaded",p),p=null),t?.()}}else return D(e)};j.registerEntity=G;j.BaseEntity=x;export{j as default};
